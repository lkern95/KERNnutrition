.kb-meal-row > .kb-pill:not(:last-of-type) {
  border-right: 1px solid rgb(212 212 212);
  margin-right: -1px;
}
/* Ein Grid für ALLE Zeilen (auch Gym + Summe) */
.kb-meal-grid {
  --col-time: 3.75rem;   /* "07:15" */
  --col-title: 1fr;
  --col-pill: 3.5rem;    /* P/C/F Pillen */
  --col-kcal: 5.75rem;   /* "425 kcal" */
  --col-actions: 7.5rem; /* −15m +15m */
}
.kb-meal-row {
  display: grid;
  grid-template-columns:
    var(--col-time) var(--col-title)
    var(--col-pill) var(--col-pill) var(--col-pill)
    var(--col-kcal) var(--col-actions);
  align-items: center;
  gap: .5rem; /* ≈ gap-2 */
}

/* Zahlen fester Zeichenabstand */
.kb-num { font-variant-numeric: tabular-nums; font-feature-settings:"tnum"; }

/* Macro-Pill mit fixer Breite – total inkl. Padding/Border */
.kb-pill {
  display: inline-flex; justify-content: space-between; align-items: center;
  width: var(--col-pill);
  padding: .125rem .5rem; border-radius: 9999px;
  border: 1px solid rgb(212 212 212); font-size: .75rem; /* text-xs */
}
.dark .kb-pill { border-color: rgb(64 64 64); }
/* gemeinsame Spaltenbreiten für die Mahlzeitenliste */
.kb-meal-grid {
  --col-time: 3.75rem;       /* 08:00 */
  --col-macros: 11.5rem;     /* drei Pills à ~3.5rem + Gaps */
  --col-kcal: 5.5rem;        /* "275 kcal" rechtsbündig */
  --col-actions: 7.5rem;     /* zwei Buttons */
}

/* Zahlendarstellung mit fester Ziffernbreite */
.kb-tnum { font-variant-numeric: tabular-nums; }

/* Macro-Pill: fixe Breite, Wert rechts ausgerichtet */
.kb-macro {
  @apply inline-flex items-center justify-between px-2 py-0.5 rounded-full border
         border-neutral-300 dark:border-neutral-700 text-xs kb-tnum;
  width: 3.5rem;            /* sorgt für Spalten-Ausgleich P/C/F */
}
/* Meal grid column variables */
.kb-meal-grid{
  --col-time: 3.75rem;
  --col-macros: 11.5rem;
  --col-kcal: 5.5rem;
  --col-actions: 7.5rem;
}

/* Jede Zeile benutzt exakt dieses Grid */
.kb-meal-row{
  display: grid;
  grid-template-columns: var(--col-time) 1fr var(--col-macros) var(--col-kcal) var(--col-actions);
  align-items: center;
  gap: .5rem; /* = Tailwind gap-2 */
}

/* Zahlen stehen nicht „wackelig“ */
.kb-tnum{
  font-variant-numeric: tabular-nums;
}

/* Macro-Pill mit fixer Breite */
.kb-macro{
  width: 3.5rem;
}
/* KERNbalance Meal Grid Styles */
.kb-meal-grid{
  --col-time: 3.75rem;
  --col-macros: 11.5rem;
  --col-kcal: 5.5rem;
  --col-actions: 7.5rem;
}

/* jede Zeile benutzt exakt dieses Grid */
.kb-meal-row{
  display: grid;
  grid-template-columns: var(--col-time) 1fr var(--col-macros) var(--col-kcal) var(--col-actions);
  align-items: center;
  gap: .5rem; /* = Tailwind gap-2 */
}

/* Zahlen stehen nicht „wackelig“ */
.kb-tnum{
  font-variant-numeric: tabular-nums;
}

/* Macro-Pill mit fixer Breite */
.kb-macro{
  width: 3.5rem;
}
/* gemeinsame Spaltenbreiten für die Mahlzeitenliste */
.kb-meal-grid {
  --col-time: 3.75rem;       /* 08:00 */
  --col-macros: 11.5rem;     /* drei Pills à ~3.5rem + Gaps */
  --col-kcal: 5.5rem;        /* "275 kcal" rechtsbündig */
  --col-actions: 7.5rem;     /* zwei Buttons */
}

/* Zahlendarstellung mit fester Ziffernbreite */
.kb-tnum { font-variant-numeric: tabular-nums; }

/* Macro-Pill: fixe Breite, Wert rechts ausgerichtet */
.kb-macro {
  @apply inline-flex items-center justify-between px-2 py-0.5 rounded-full border border-neutral-300 dark:border-neutral-700 text-xs kb-tnum;
  width: 3.5rem;            /* sorgt für Spalten-Ausgleich P/C/F */
}
.kb-pill-protein { @apply kb-pill bg-emerald-100 dark:bg-emerald-900/40 text-emerald-900 dark:text-emerald-200 border-emerald-200 dark:border-emerald-800; }
.kb-pill-carb    { @apply kb-pill bg-blue-100   dark:bg-blue-900/40   text-blue-900   dark:text-blue-200   border-blue-200   dark:border-blue-800; }
.kb-pill-fat     { @apply kb-pill bg-amber-100  dark:bg-amber-900/40  text-amber-900  dark:text-amber-200  border-amber-200  dark:border-amber-800; }
.kb-seg { @apply text-sm px-3 py-1 rounded-full border border-neutral-300 dark:border-neutral-700
                 bg-white dark:bg-neutral-800 text-neutral-800 dark:text-neutral-100 hover:bg-neutral-50
                 dark:hover:bg-neutral-700 transition; }
.kb-seg--active { @apply bg-emerald-600 text-white border-emerald-600; }
.kb-pill { @apply text-xs px-2 py-0.5 rounded-full border border-neutral-300 dark:border-neutral-700; }
/* ===== KERNnutrition UI Tokens ===== */
.kb-card {
  @apply rounded-2xl border border-neutral-200 dark:border-neutral-800 bg-white dark:bg-neutral-900 shadow-sm;
}
.kb-tile {
  @apply kb-card p-4 flex items-center gap-3;
}
.kb-title {
  @apply font-semibold text-base text-neutral-900 dark:text-neutral-100 flex items-center gap-2;
}
.kb-input {
  @apply w-full rounded-xl border border-neutral-300 dark:border-neutral-700 bg-white dark:bg-neutral-900
         text-neutral-900 dark:text-neutral-100 placeholder-neutral-400
         focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500;
}
.kb-chip {
  @apply px-3 py-1 rounded-full border border-neutral-300 dark:border-neutral-700 bg-white dark:bg-neutral-800
         text-neutral-800 dark:text-neutral-100 hover:bg-neutral-50 dark:hover:bg-neutral-700 active:scale-95 transition;
}
.kb-badge-pre    { @apply px-1 rounded bg-amber-100  dark:bg-amber-900/40  text-amber-900  dark:text-amber-200; }
.kb-badge-post   { @apply px-1 rounded bg-blue-100   dark:bg-blue-900/40   text-blue-900   dark:text-blue-200; }
.kb-badge-sleep  { @apply px-1 rounded bg-purple-100 dark:bg-purple-900/40 text-purple-900 dark:text-purple-200; }
.kb-badge-wake   { @apply px-1 rounded bg-green-100  dark:bg-green-900/40  text-green-900  dark:text-green-200; }
@tailwind base;
@tailwind components;
@tailwind utilities;

@layer utilities {
  .card {
    @apply rounded-2xl border shadow-xl p-5;
    transition: box-shadow .3s ease, transform .3s ease;
  }
  .card-hover:hover {
    transform: translateY(-4px);
    box-shadow: 0 14px 30px rgba(0,0,0,.25);
  }
  .soft-border { border-color: rgba(255,208,0,.15); }
  .ink { background: #292c2f; color: #ececec; }
  .gold { color: #ffd000; }
  .violet { color: #32174d; }
  .bg-ink { background: #292c2f; }
  .bg-violet-soft { background: rgba(50,23,77,.25); }
  .bg-gold-soft { background: rgba(255,208,0,.1); }

  /* Accordion helpers */
  .acc summary::-webkit-details-marker { display: none; }
  .acc summary { list-style: none; cursor: pointer; }
  .chev { transition: transform .25s ease; }
  details[open] .chev { transform: rotate(90deg); }

  /* Pop-in */
  @keyframes pop { 0%{transform:translateY(6px) scale(.98);opacity:0} 100%{transform:none;opacity:1} }
  .pop-in { animation: pop .5s ease-out both; }
  .pop-in-1 { animation-delay: .06s }
  .pop-in-2 { animation-delay: .12s }
  .pop-in-3 { animation-delay: .18s }
}

/* Makro-Variablen global */
:root {
  --macro-fat: #ffd000;
  --macro-carb: #e94f37;
  --macro-protein: #ececec;
}

@layer base {
  html {
    font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  }
  body {
    @apply bg-background text-text;
    margin: 0;
    padding: 0;
    min-height: 100vh;
    overscroll-behavior: none;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
  * {
    box-sizing: border-box;
  }
  h1 {
    @apply text-2xl font-bold text-text leading-tight;
  }
  h2 {
    @apply text-xl font-semibold text-text leading-tight;
  }
  h3 {
    @apply text-lg font-medium text-text leading-tight;
  }
  h4 {
    @apply text-base font-medium text-text leading-tight;
  }
  p {
    @apply text-base text-text/80 leading-relaxed;
  }
  .text-title {
    @apply text-2xl font-bold text-text leading-tight;
  }
  .text-label {
    @apply text-sm font-medium text-text leading-tight;
  }
  .text-base-content {
    @apply text-base text-text/80 leading-relaxed;
  }
  /* Verbesserter Fokus für Barrierefreiheit */
  *:focus-visible {
    @apply outline-2 outline-accent outline-offset-2;
  }
  /* Performance: Reduce animations on low-power devices */
  @media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
      scroll-behavior: auto !important;
    }
  }
}

@layer utilities {
  .text-macro-fat     { color: var(--macro-fat) !important; }
  .text-macro-carb    { color: var(--macro-carb) !important; }
  .text-macro-protein { color: var(--macro-protein) !important; }
  .bg-macro-fat     { background: var(--macro-fat) !important; }
  .bg-macro-carb    { background: var(--macro-carb) !important; }
  .bg-macro-protein { background: var(--macro-protein) !important; }
}

@layer components {
  .container-card {
    @apply bg-background border border-accent/20 rounded-xl shadow-soft;
  }
  
  .tab-button {
    @apply flex flex-col items-center justify-center transition-colors duration-200;
    @apply text-text/70 hover:text-text hover:bg-text/5;
    @apply focus:outline-none focus:ring-2 focus:ring-accent/50;
    @apply h-16 min-w-0 px-0 py-0 flex-1;
    min-width: 0;
    min-height: 4rem;
    border-radius: 0;
    /* Kein Reflow, alle Tabs gleich groß */
  }
  
  .tab-button.active {
    @apply text-accent bg-accent/10;
  }
  
  .primary-button {
    @apply bg-accent text-icon font-semibold py-3 px-6 rounded-lg;
    @apply hover:bg-accent/90 focus:ring-2 focus:ring-accent/50;
    @apply transition-all duration-200 shadow-soft;
    @apply min-h-[3rem]; /* Mindesthöhe für Touch */
  }
  
  .secondary-button {
    @apply bg-text/10 text-text font-medium py-3 px-6 rounded-lg;
    @apply hover:bg-text/20 focus:ring-2 focus:ring-accent/50;
    @apply transition-all duration-200;
    @apply min-h-[3rem];
  }

  .safe-area-bottom {
    padding-bottom: env(safe-area-inset-bottom);
  }

  .safe-area-top {
    padding-top: env(safe-area-inset-top);
  }
}

@layer utilities {
  .z-50 {
    z-index: 50;
  }
}

/* Mobile Optimierung für Mahlzeitenliste */
@media (max-width: 600px) {
  .kb-meal-grid {
    /* Grid auf eine Spalte umstellen */
    --col-time: 100%;
    --col-title: 100%;
    --col-macros: 100%;
    --col-kcal: 100%;
    --col-actions: 100%;
  }
  .kb-meal-row {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    gap: 0.25rem;
    padding: 0.5rem 0;
  }
  .kb-meal-row > * {
    width: 100%;
    margin-bottom: 0.25rem;
  }
  .kb-pill, .kb-macro {
    width: 100%;
    justify-content: flex-start;
    font-size: 0.95rem;
    margin-bottom: 0.15rem;
  }
  .kb-meal-row .kb-num {
    font-size: 1rem;
  }
  .kb-meal-row .truncate {
    white-space: normal;
    overflow: visible;
    text-overflow: unset;
  }
}

/* PWA-spezifische Styles */
@media (display-mode: standalone) {
  body {
    padding-top: env(safe-area-inset-top);
    padding-bottom: env(safe-area-inset-bottom);
  }
}

/* Custom range slider styles */
@layer components {
  .slider::-webkit-slider-thumb {
    appearance: none;
    height: 20px;
    width: 20px;
    border-radius: 50%;
    background: rgb(var(--primary));
    cursor: pointer;
    border: 2px solid rgb(var(--background));
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  }

  .slider::-webkit-slider-track {
    width: 100%;
    height: 8px;
    cursor: pointer;
    background: rgb(var(--border));
    border-radius: 4px;
  }

  .slider::-moz-range-thumb {
    height: 20px;
    width: 20px;
    border-radius: 50%;
    background: rgb(var(--primary));
    cursor: pointer;
    border: 2px solid rgb(var(--background));
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  }

  .slider::-moz-range-track {
    width: 100%;
    height: 8px;
    cursor: pointer;
    background: rgb(var(--border));
    border-radius: 4px;
    border: none;
  }

  /* Focus states for accessibility */
  .slider:focus::-webkit-slider-thumb {
    box-shadow: 0 0 0 2px rgb(var(--primary) / 0.2);
  }

  .slider:focus::-moz-range-thumb {
    box-shadow: 0 0 0 2px rgb(var(--primary) / 0.2);
  }

  /* Success and error text colors */
  .text-success {
    color: #22c55e;
  }

  .text-error {
    color: #ef4444;
  }

  .bg-error\/10 {
    background-color: rgb(239 68 68 / 0.1);
  }

  .border-error\/20 {
    border-color: rgb(239 68 68 / 0.2);
  }
}
@layer utilities {
  /* Höhe der Bottom-Nav (ohne Safe-Area) */
  .bn-h { height: 64px; }

  /* Safe-Area unten (iOS Notch etc.) */
  .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
  .mb-safe { margin-bottom: env(safe-area-inset-bottom); }

  /* Platz für Bottom-Nav im Content, damit nichts überlappt */
  .with-bottom-nav-pb { padding-bottom: calc(64px + env(safe-area-inset-bottom)); }

  /* Label immer einzeilig & nicht umbrechen */
  .tab-label {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    line-height: 1;
  }
}
.kb-btn-xs { @apply text-sm px-3 py-1 h-9 rounded-xl border border-neutral-300 dark:border-neutral-700 bg-white dark:bg-neutral-800 hover:bg-neutral-50 dark:hover:bg-neutral-700; }
.kb-pill   { @apply text-xs px-2 py-0.5 rounded-full border border-neutral-300 dark:border-neutral-700; }
.kb-hint   { @apply text-xs text-neutral-500 dark:text-neutral-400; }
